<div class="workmap-container">
  <aside class="sidebar">
    <div class="sidebar__section">
      <button
        class="sidebar__button"
        (click)="filtrosVisiveis = !filtrosVisiveis"
        title="Abrir filtros de busca"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="sidebar__icon"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
      </button>
    </div>
    <div class="sidebar__section sidebar__section--bottom">

      <button
        class="sidebar__button"
        title="Ver perfil"
        (click)="verPerfil()"
        matBadge=" "
        matBadgeColor="warn"
        [matBadgeHidden]="!temNotificacao"
        matBadgeSize="small"
      >
      <svg
          xmlns="http://www.w3.org/2000/svg"
          class="sidebar__icon sidebar__icon--profile"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
            clip-rule="evenodd"
          />
        </svg>
      </button>
      <span class="sidebar__label">Perfil</span>
    </div>
  </aside>

  <div class="main-content">

    <div class="filter-panel" [class.is-visible]="filtrosVisiveis">
      <div class="filter-panel__header">
        <h2 class="filter-panel__title">Filtros de Busca</h2>
        <button
          class="filter-panel__close-btn"
          (click)="filtrosVisiveis = false"
          title="Fechar filtros"
        >
          ×
        </button>
      </div>
      <div class="filter-panel__body">
        <label class="filter-panel__label">Raio de Pesquisa (km)</label>
        <div class="range-slider">
          <input
            type="range"
            min="1"
            max="10"
            [(ngModel)]="raio"
            class="range-slider__input"
          />
          <span class="range-slider__value">{{ raio }} km</span>
        </div>
      </div>
      <button
        class="filter-panel__apply-btn"
        (click)="obterLocalizacaoUsuario()"
      >
        Atualizar Busca
      </button>
    </div>

    <div class="dashboard-body">

      <main class="map-area">
        <google-map [center]="center" [zoom]="zoom" height="100%" width="100%">

          <map-marker
            [position]="center"
            [title]="'Você está aqui'"
            [options]="{
              icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'

            }"
          >
          </map-marker>
          <map-circle
            [center]="center"
            [radius]="raio * 1000"
            [options]="{
              strokeColor: '#1E90FF',
              strokeOpacity: 0.8,
              strokeWeight: 2,
              fillColor: '#1E90FF',
              fillOpacity: 0.15
            }"
          >
          </map-circle>

          <map-marker
            *ngFor="let vaga of vagas"
            [position]="vaga.posicao"
            [title]="vaga.titulo"
            (mapClick)="abrirInfoWindow(marker, vaga)"
            #marker="mapMarker"
            [options]="getMarkerOptions(vaga)"
          >
          </map-marker>

          <map-info-window>
            <div class="info-window" *ngIf="infoContent">
              <h3 class="info-window__title">{{ infoContent.titulo }}</h3>
              <p class="info-window__desc">{{ infoContent.descricao }}</p>

              <div [ngSwitch]="getStatusCandidatura(infoContent)">
                <button
                  *ngSwitchCase="'NaoInscrito'"
                  class="info-window__button"
                  (click)="mostrarDetalhes(infoContent)"
                >
                  Ver Detalhes
                </button>
                <button
                  *ngSwitchCase="'Pendente'"
                  class="info-window__button info-window__button--applied"
                  (click)="mostrarDetalhes(infoContent)"
                  disabled
                >
                  Inscrito
                </button>
                <button
                  *ngSwitchCase="'Aceito'"
                  class="info-window__button info-window__button--accepted"
                  (click)="mostrarDetalhes(infoContent)"
                  disabled
                >
                  Você foi selecionado!
                </button>
                <button
                  *ngSwitchCase="'Recusado'"
                  class="info-window__button info-window__button--refused"
                  (click)="mostrarDetalhes(infoContent)"
                  disabled
                >
                  Vaga Preenchida
                </button>
              </div>

            </div>
          </map-info-window>
        </google-map>
      </main>

      <aside class="job-list-panel">

        <div *ngIf="!vagaSelecionada; else detalheVagaView" class="job-list-container">
          <h3 class="job-list-title">Vagas Próximas</h3>
          <div class="job-list-scroll-container">

            <mat-card *ngIf="vagas.length === 0" class="job-card">
              <mat-card-content>
                <p>Nenhuma vaga encontrada. Tente atualizar a busca.</p>
              </mat-card-content>
            </mat-card>

            <mat-card
              *ngFor="let vaga of vagas"
              class="job-card"
              (click)="mostrarDetalhes(vaga)"
            >
              <mat-card-header>
                <mat-card-title>{{ vaga.titulo }}</mat-card-title>
                <mat-card-subtitle>{{ vaga.nomeEmpresa }}</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <p>{{ vaga.descricao | slice:0:100 }}{{ vaga.descricao.length > 100 ? '...' : '' }}</p>
              </mat-card-content>
            </mat-card>
          </div>
        </div>

        <ng-template #detalheVagaView>
          <div class="job-detail-container" *ngIf="vagaSelecionada">

            <div class="job-detail-header">
              <button mat-icon-button (click)="voltarParaLista()" title="Voltar para a lista">
                <mat-icon>arrow_back</mat-icon>
              </button>
              <h3 class="job-detail-title">Detalhes da Vaga</h3>
            </div>

            <div class="job-detail-scroll-container">
              <mat-card class="job-detail-card">
                <mat-card-header>
                  <mat-card-title>{{ vagaSelecionada.titulo }}</mat-card-title>
                  <mat-card-subtitle>{{ vagaSelecionada.nomeEmpresa }}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="detail-item">
                    <mat-icon>location_on</mat-icon>
                    <span>{{ vagaSelecionada.endereco || 'Endereço não informado' }}</span>
                  </div>
                  <div class="detail-item">
                    <mat-icon>schedule</mat-icon>
                    <span>{{ vagaSelecionada.tempoMedioEstimado || 'Não informado' }}</span>
                  </div>
                  <div class="detail-item description">
                    <mat-icon>description</mat-icon>
                    <p>{{ vagaSelecionada.descricao }}</p>
                  </div>

                </mat-card-content>
              </mat-card>
            </div>

            <div class="job-detail-footer" [ngSwitch]="getStatusCandidatura(vagaSelecionada)">

              <button
                *ngSwitchCase="'NaoInscrito'"
                mat-raised-button
                color="primary"
                (click)="candidatar(usuarioLogado.id, vagaSelecionada.id)"
              >
                Candidatar-se
              </button>

              <button *ngSwitchCase="'Pendente'" mat-raised-button disabled>
                <mat-icon>check</mat-icon>
                Aguardando resultado
              </button>

              <button *ngSwitchCase="'Aceito'" mat-raised-button class="btn-aceito" disabled>
                <mat-icon>celebration</mat-icon>
                Você foi selecionado!
              </button>

              <button *ngSwitchCase="'Recusado'" mat-raised-button class="btn-recusado" disabled>
                <mat-icon>block</mat-icon>
                Vaga já preenchida
              </button>
            </div>

          </div>
        </ng-template>

      </aside>

    </div>

    <footer class="footer">
      <p class="footer__copyright">
        Empre-GO! - © 2025 | Todos os Direitos Reservados.
      </p>
      <div class="footer__socials">
        <a href="#" class="footer__social-link" title="Facebook">F</a>
        <a href="#" class="footer__social-link" title="LinkedIn">L</a>
        <a href="#" class="footer__social-link" title="Instagram">I</a>
      </div>
    </footer>
  </div>
</div>
